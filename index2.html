<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recovery Journey Tool | Luxe Edition</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Cormorant+Garamond:wght@300;400;500;600;700&family=Raleway:wght@300;400;500&family=Dancing+Script:wght@400;500&family=Parisienne&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --soft-grey: #F5F5F7;
            --light-grey: #EAEAEC;
            --medium-grey: #D8D8DC;
            --lilac: #C8A2C8;
            --soft-lilac: #E6D4E6;
            --blush: #FFD1DC;
            --soft-blush: #FFEBF0;
            --gold: #D4AF37;
            --light-gold: #EBD99F;
            --cream: #FAF7F2;
            --pearl: #FFFEFC;
            --platinum: #F0F0F5;
            --silk: #F8F6F2;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: linear-gradient(135deg, var(--soft-grey) 0%, var(--light-grey) 50%, var(--platinum) 100%);
            min-height: 100vh;
            padding: 20px;
            color: #555;
            letter-spacing: 0.2px;
            line-height: 1.6;
            font-weight: 400;
            font-style: italic;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Progress Bar - Elegant Redesign */
        .progress-bar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 32px;
            border: 1px solid rgba(200, 162, 200, 0.2);
            box-shadow: 0 8px 32px rgba(200, 162, 200, 0.1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--soft-lilac), var(--soft-blush), var(--light-gold));
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-label {
            font-family: 'Parisienne', cursive;
            font-size: 18px;
            color: var(--lilac);
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .progress-count {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            color: var(--blush);
            font-weight: 500;
            background: rgba(255, 209, 220, 0.15);
            padding: 6px 16px;
            border-radius: 20px;
            border: 1px solid rgba(255, 209, 220, 0.3);
        }

        .progress-track {
            width: 100%;
            height: 6px;
            background: rgba(200, 162, 200, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--soft-lilac) 0%, var(--soft-blush) 50%, var(--light-gold) 100%);
            border-radius: 3px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px rgba(200, 162, 200, 0.2);
        }

        /* Main Card - Luxury Design */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 60px 48px;
            border: 1px solid rgba(200, 162, 200, 0.1);
            box-shadow: 
                0 20px 60px rgba(200, 162, 200, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--soft-lilac), var(--soft-blush), transparent);
        }

        .save-indicator {
            text-align: center;
            margin-top: 32px;
            font-size: 15px;
            color: var(--lilac);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            opacity: 0.8;
            font-style: italic;
        }

        .save-indicator span:first-child {
            font-size: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Typography - Elegant */
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--lilac) 0%, var(--blush) 30%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.2;
            letter-spacing: 0.5px;
            font-style: normal;
        }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.6rem;
            font-weight: 500;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.3;
            position: relative;
            padding-bottom: 20px;
            font-style: normal;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--lilac), var(--blush), transparent);
        }

        h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 500;
            color: var(--blush);
            margin-bottom: 20px;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        h4 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--lilac);
            margin-bottom: 16px;
            letter-spacing: 0.3px;
            font-style: italic;
        }

        p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            line-height: 1.7;
            color: #666;
            font-weight: 400;
            font-style: italic;
        }

        /* Hero Elements */
        .hero-icon {
            text-align: center;
            font-size: 4.5rem;
            margin-bottom: 32px;
            filter: drop-shadow(0 8px 20px rgba(200, 162, 200, 0.2));
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .module-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 40px;
            border: 2px solid rgba(200, 162, 200, 0.2);
            box-shadow: 0 15px 40px rgba(200, 162, 200, 0.1);
            transition: transform 0.5s ease;
        }

        .module-image:hover {
            transform: scale(1.01);
        }

        /* Info Boxes - Luxury Style */
        .info-box {
            background: linear-gradient(135deg, 
                rgba(200, 162, 200, 0.08) 0%, 
                rgba(255, 209, 220, 0.05) 100%);
            border-left: 4px solid var(--lilac);
            padding: 28px;
            border-radius: 12px;
            margin: 32px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(200, 162, 200, 0.1);
        }

        .info-box.pink {
            background: linear-gradient(135deg, 
                rgba(255, 209, 220, 0.08) 0%, 
                rgba(255, 230, 236, 0.05) 100%);
            border-left-color: var(--blush);
        }

        .info-box.gold {
            background: linear-gradient(135deg, 
                rgba(212, 175, 55, 0.08) 0%, 
                rgba(255, 240, 200, 0.05) 100%);
            border-left-color: var(--gold);
        }

        .info-box h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 12px;
            font-weight: 600;
            font-style: normal;
        }

        .info-box p {
            color: #666;
            font-size: 1rem;
            line-height: 1.7;
        }

        .info-box a {
            color: var(--blush);
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 209, 220, 0.3);
            transition: border-color 0.3s ease;
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        .info-box a:hover {
            border-bottom-color: var(--blush);
        }

        /* Grid Layout - Elegant */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin: 40px 0;
        }

        .grid-item {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(200, 162, 200, 0.15);
            padding: 32px 24px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .grid-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--soft-lilac), var(--soft-blush));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .grid-item:hover {
            transform: translateY(-4px);
            border-color: rgba(200, 162, 200, 0.3);
            box-shadow: 0 15px 40px rgba(200, 162, 200, 0.1);
        }

        .grid-item:hover::before {
            opacity: 1;
        }

        .grid-item.pink {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 209, 220, 0.2);
        }

        .grid-item .icon {
            font-size: 2.8rem;
            margin-bottom: 20px;
            display: block;
        }

        /* Form Elements - Luxury */
        label {
            display: block;
            font-family: 'Cormorant Garamond', serif;
            font-weight: 500;
            color: var(--lilac);
            margin-bottom: 12px;
            font-size: 1.2rem;
            letter-spacing: 0.3px;
            font-style: italic;
        }

        input[type="text"],
        input[type="date"],
        input[type="file"],
        textarea {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(200, 162, 200, 0.2);
            border-radius: 12px;
            color: #666;
            font-size: 1rem;
            font-family: 'Cormorant Garamond', serif;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            font-style: italic;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="file"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--blush);
            box-shadow: 0 0 0 3px rgba(255, 209, 220, 0.1);
        }

        input[type="text"]::placeholder,
        textarea::placeholder {
            color: rgba(150, 150, 150, 0.5);
            font-style: italic;
            font-family: 'Cormorant Garamond', serif;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            font-style: italic;
            line-height: 1.6;
        }

        /* Buttons - Luxury */
        .button-group {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        button {
            flex: 1;
            padding: 18px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-family: 'Raleway', sans-serif;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            font-style: normal;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: left 0.7s ease;
        }

        button:hover::before {
            left: 100%;
        }

        button.primary {
            background: linear-gradient(135deg, 
                var(--lilac) 0%, 
                var(--blush) 50%, 
                rgba(212, 175, 55, 0.8) 100%);
            color: white;
            box-shadow: 0 12px 30px rgba(200, 162, 200, 0.3);
        }

        button.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(200, 162, 200, 0.4);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--lilac);
            border: 1px solid rgba(200, 162, 200, 0.3);
            backdrop-filter: blur(10px);
        }

        button.secondary:hover {
            background: white;
            border-color: var(--lilac);
            transform: translateY(-3px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Numerology Results - Luxury */
        .numerology-result {
            background: linear-gradient(135deg, 
                rgba(200, 162, 200, 0.1) 0%, 
                rgba(255, 209, 220, 0.08) 100%);
            padding: 48px;
            border-radius: 20px;
            border: 2px solid rgba(200, 162, 200, 0.2);
            margin: 40px 0;
            text-align: center;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 50px rgba(200, 162, 200, 0.1);
            position: relative;
        }

        .numerology-result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23c8a2c8' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .numerology-circle {
            display: inline-block;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            border: 4px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.2);
            position: relative;
            z-index: 1;
        }

        .numerology-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            font-style: normal;
        }

        .numerology-subtitle {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            color: var(--lilac);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .numerology-message {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            line-height: 1.8;
            color: #666;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        /* Vision Board Upload - Luxury */
        .file-upload-container {
            position: relative;
            margin: 32px 0;
        }

        .file-upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 40px;
            border: 3px dashed rgba(200, 162, 200, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-upload-label:hover {
            border-color: var(--blush);
            background: white;
            transform: translateY(-2px);
        }

        .file-upload-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--lilac);
        }

        .file-upload-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 12px;
            font-weight: 500;
            font-style: italic;
        }

        .file-upload-subtext {
            font-size: 0.9rem;
            color: rgba(150, 150, 150, 0.8);
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        #fileInput {
            display: none;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 32px;
        }

        .image-container {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(200, 162, 200, 0.2);
            transition: all 0.3s ease;
            background: white;
        }

        .image-container:hover {
            transform: translateY(-4px);
            border-color: var(--lilac);
            box-shadow: 0 15px 30px rgba(200, 162, 200, 0.1);
        }

        .image-container img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .image-remove {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--blush);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            font-size: 1.5rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 209, 220, 0.2);
            font-family: 'Raleway', sans-serif;
            font-style: normal;
        }

        .image-container:hover .image-remove {
            opacity: 1;
        }

        .image-remove:hover {
            background: var(--blush);
            color: white;
            transform: scale(1.1);
        }

        .image-name {
            padding: 12px;
            font-size: 0.9rem;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            background: rgba(250, 250, 250, 0.9);
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        /* Arrangement Controls */
        .arrangement-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }

        .arrange-btn {
            background: rgba(200, 162, 200, 0.1);
            border: 1px solid rgba(200, 162, 200, 0.2);
            color: var(--lilac);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-family: 'Raleway', sans-serif;
            transition: all 0.3s ease;
            font-style: normal;
        }

        .arrange-btn:hover {
            background: rgba(200, 162, 200, 0.2);
            border-color: var(--lilac);
        }

        /* List Styles */
        ul {
            list-style: none;
            margin: 20px 0;
        }

        li {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            line-height: 1.7;
            color: #666;
            font-weight: 400;
            margin-bottom: 12px;
            padding-left: 28px;
            position: relative;
            font-style: italic;
        }

        li::before {
            content: '‚ùÄ';
            position: absolute;
            left: 0;
            color: var(--lilac);
            font-size: 0.9rem;
        }

        /* Hidden Utility */
        .hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            h1 {
                font-size: 2.4rem;
            }

            h2 {
                font-size: 2rem;
            }

            .card {
                padding: 40px 24px;
            }

            .button-group {
                flex-direction: column;
            }

            .progress-bar {
                padding: 16px 20px;
            }

            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 16px;
            }
        }

        /* Handwritten Elements */
        .handwriting {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--blush);
            font-weight: 400;
            margin: 20px 0;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .gold-accent {
            color: var(--gold);
            font-weight: 500;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(240, 240, 240, 0.8);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--soft-lilac), var(--soft-blush));
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--soft-blush), var(--soft-lilac));
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-header">
                <span class="progress-label">Your Journey Progress</span>
                <span class="progress-count" id="progressCount">1 of 7</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill" style="width: 14.28%"></div>
            </div>
        </div>

        <!-- Main Card -->
        <div class="card" id="mainCard">
            <!-- Content will be dynamically inserted here -->
        </div>

        <!-- Save Indicator -->
        <div class="save-indicator">
            <span>üíé</span>
            <span>Your work is automatically saved</span>
        </div>
    </div>

    <script>
        // State management
        let currentModule = 0;
        let data = {
            playingTape: { trigger: '', thoughts: '', actions: '', consequences: '', feelings: '' },
            visionBoard: { images: [], goals: ['', '', ''] },
            birthDate: '',
            sobrietyDate: '',
            numerology: null,
            letterToFuture: '',
            letterFromFuture: ''
        };

        // Load saved data on page load
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('recoveryJourneyData');
            if (saved) {
                data = JSON.parse(saved);
            }
            renderModule();
        });

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('recoveryJourneyData', JSON.stringify(data));
        }

        // Update progress bar
        function updateProgress() {
            const progress = ((currentModule + 1) / 7) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressCount').textContent = `${currentModule + 1} of 7`;
        }

        // Navigate between modules
        function goToModule(index) {
            currentModule = index;
            updateProgress();
            renderModule();
            window.scrollTo(0, 0);
        }

        // Numerology calculation
        function calculateNumerology(birthDateStr, sobrietyDateStr) {
            if (!birthDateStr || !sobrietyDateStr) return null;

            const reduceToSingle = (num) => {
                while (num > 9 && num !== 11 && num !== 22 && num !== 33) {
                    num = num.toString().split('').reduce((acc, digit) => acc + parseInt(digit), 0);
                }
                return num;
            };

            const birthDigits = birthDateStr.replace(/\D/g, '');
            let lifePathSum = birthDigits.split('').reduce((acc, digit) => acc + parseInt(digit), 0);
            const lifePath = reduceToSingle(lifePathSum);

            const today = new Date();
            const birthDate = new Date(birthDateStr);
            const currentYear = today.getFullYear();
            const personalYearSum = birthDate.getDate() + (birthDate.getMonth() + 1) + currentYear;
            const personalYear = reduceToSingle(personalYearSum);

            const checkKarmicDebt = (dateStr) => {
                const nums = dateStr.replace(/\D/g, '').match(/.{1,2}/g) || [];
                const karmicNumbers = [];
                nums.forEach(num => {
                    const n = parseInt(num);
                    if ([13, 14, 16, 19].includes(n)) karmicNumbers.push(n);
                });
                return karmicNumbers;
            };

            const karmicDebt = checkKarmicDebt(birthDateStr);

            const lifePathMeanings = {
                1: { title: "The Pioneer", message: "You are a natural leader, independent and driven. Your recovery journey is about reclaiming your personal power." },
                2: { title: "The Peacemaker", message: "You seek harmony and balance. Your recovery is about finding inner peace." },
                3: { title: "The Creative Spirit", message: "Expression and joy are your gifts. In sobriety, you'll rediscover your authentic voice." },
                4: { title: "The Builder", message: "You create solid foundations. Every sober day is a brick in your new life." },
                5: { title: "The Freedom Seeker", message: "You crave adventure. True freedom comes through sobriety." },
                6: { title: "The Nurturer", message: "You care deeply. In recovery, you'll learn to nurture yourself too." },
                7: { title: "The Seeker", message: "Your journey is deeply spiritual. Sobriety will reveal profound truths." },
                8: { title: "The Powerhouse", message: "You understand abundance. Recovery returns your personal power." },
                9: { title: "The Humanitarian", message: "You have wisdom to share. Your recovery will inspire others." },
                11: { title: "The Illuminator", message: "Master number - Your sobriety will light the way for others." },
                22: { title: "The Master Builder", message: "Master number - You'll create something extraordinary." },
                33: { title: "The Master Teacher", message: "Master number - Your recovery will heal many." }
            };

            const personalYearMeanings = {
                1: "New Beginnings - Perfect for starting recovery",
                2: "Balance & Relationships - Focus on healing connections",
                3: "Self-Expression - Rediscover your voice",
                4: "Building Foundations - Establish routines",
                5: "Change & Freedom - Embrace transformation",
                6: "Nurturing - Learn self-compassion",
                7: "Introspection - Ideal for deep healing",
                8: "Personal Power - Reclaim your strength",
                9: "Completion - Let go of the past"
            };

            const karmicMeanings = {
                13: "Discipline & Focus - Your growth requires dedication",
                14: "Moderation - Learning balance is your path",
                16: "Ego & Humility - Surrender control",
                19: "Independence - Stand on your own, but accept help"
            };

            return {
                lifePath: { number: lifePath, ...lifePathMeanings[lifePath] },
                personalYear: { number: personalYear, meaning: personalYearMeanings[personalYear] },
                karmicDebt: karmicDebt.map(n => ({ number: n, meaning: karmicMeanings[n] }))
            };
        }

        // Vision Board File Upload
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.visionBoard.images.push({
                        name: file.name,
                        data: e.target.result,
                        order: data.visionBoard.images.length
                    });
                    saveData();
                    updateImageGrid();
                };
                reader.readAsDataURL(file);
            }
            // Reset input to allow selecting same file again
            event.target.value = '';
        }

        function updateImageGrid() {
            const grid = document.getElementById('imageGrid');
            if (grid) {
                grid.innerHTML = renderImageGrid();
                setupImageControls();
            }
        }

        function renderImageGrid() {
            if (data.visionBoard.images.length === 0) {
                return '<p style="text-align: center; color: rgba(150,150,150,0.5); font-style: italic;">No images added yet. Upload some images to create your vision board.</p>';
            }
            
            // Sort images by order
            const sortedImages = [...data.visionBoard.images].sort((a, b) => a.order - b.order);
            
            return sortedImages.map((img, i) => `
                <div class="image-container">
                    <img src="${img.data}" alt="${img.name}" data-index="${i}">
                    <div class="image-name">${img.name}</div>
                    <div class="arrangement-controls">
                        <button class="arrange-btn" onclick="moveImageUp(${i})" ${i === 0 ? 'disabled style="opacity:0.5;"' : ''}>‚Üë</button>
                        <button class="arrange-btn" onclick="moveImageDown(${i})" ${i === data.visionBoard.images.length - 1 ? 'disabled style="opacity:0.5;"' : ''}>‚Üì</button>
                        <button class="arrange-btn" onclick="removeImage(${i})">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function setupImageControls() {
            // Already set up via onclick handlers in renderImageGrid
        }

        function moveImageUp(index) {
            if (index > 0) {
                const temp = data.visionBoard.images[index].order;
                data.visionBoard.images[index].order = data.visionBoard.images[index - 1].order;
                data.visionBoard.images[index - 1].order = temp;
                
                // Sort the array
                data.visionBoard.images.sort((a, b) => a.order - b.order);
                saveData();
                updateImageGrid();
            }
        }

        function moveImageDown(index) {
            if (index < data.visionBoard.images.length - 1) {
                const temp = data.visionBoard.images[index].order;
                data.visionBoard.images[index].order = data.visionBoard.images[index + 1].order;
                data.visionBoard.images[index + 1].order = temp;
                
                // Sort the array
                data.visionBoard.images.sort((a, b) => a.order - b.order);
                saveData();
                updateImageGrid();
            }
        }

        function removeImage(index) {
            data.visionBoard.images.splice(index, 1);
            // Reassign order numbers
            data.visionBoard.images.forEach((img, i) => {
                img.order = i;
            });
            saveData();
            updateImageGrid();
        }

        // Module rendering functions
        const modules = [
            renderWelcome,
            renderPlayingTape,
            renderVisionBoard,
            renderNumerology,
            renderLetterToFuture,
            renderLetterFromFuture,
            renderCompletion
        ];

        function renderModule() {
            modules[currentModule]();
            // Re-setup file upload after rendering vision board
            if (currentModule === 2) {
                setTimeout(setupFileUpload, 100);
            }
        }

        function renderWelcome() {
            document.getElementById('mainCard').innerHTML = `
                <div class="hero-icon">‚ú®</div>
                <h1>Welcome to Your Recovery Journey</h1>
                <p class="handwriting">Where healing meets elegance</p>
                <p style="text-align: center; margin-bottom: 40px; font-size: 1.2rem;">A sacred, private space to build your vision of recovery and connect with your future self.</p>

                <div class="info-box gold">
                    <h3>Evidence-Based Techniques, Elegantly Presented</h3>
                    <p>This refined tool uses proven visualization methods from addiction recovery research‚Äîguided imagery, scenario rehearsal, and vision boarding‚Äîtechniques shown to enhance motivation, manage cravings, and strengthen sobriety goals.</p>
                </div>

                <h3 style="color: var(--blush); font-size: 1.5rem; margin: 48px 0 24px 0; text-align: center; font-style: italic;">Your Journey Includes:</h3>

                <div class="grid">
                    <div class="grid-item">
                        <div class="icon">‚èÆÔ∏è</div>
                        <h4>Playing the Tape Through</h4>
                        <p>Mentally rehearse relapse scenarios to internalize consequences and strengthen resolve.</p>
                    </div>
                    <div class="grid-item pink">
                        <div class="icon">üñºÔ∏è</div>
                        <h4>Vision Board Creation</h4>
                        <p>Craft a visual map of your recovery goals with images from your device.</p>
                    </div>
                    <div class="grid-item">
                        <div class="icon">‚ú®</div>
                        <h4>Numerology Analysis</h4>
                        <p>Discover your Life Path and Personal Year for deeper self-understanding.</p>
                    </div>
                    <div class="grid-item pink">
                        <div class="icon">üíå</div>
                        <h4>Future Self Letters</h4>
                        <p>Connect with the person you're becoming through heartfelt correspondence.</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="primary" onclick="goToModule(1)">
                        Begin Your Journey
                        <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function renderPlayingTape() {
            document.getElementById('mainCard').innerHTML = `
                <img src="https://image-cdn.klingai.com/2E67FA5DC7A24CD7AFE53DCBA8F696A4%2F9D2F0AA0831440D186E071FEA1C6FA8F/work_resize_1280_720.jpg" 
                     alt="Playing the Tape" class="module-image">
                
                <div class="hero-icon">‚èÆÔ∏è</div>
                <h2>Playing the Tape Through</h2>
                <p style="text-align: center; margin-bottom: 32px; font-size: 1.2rem;">Mentally rehearse a relapse scenario to internalize the consequences.</p>

                <div class="info-box pink">
                    <h3>The Science Behind This</h3>
                    <p>Research shows mentally rehearsing full consequences of relapse improves decision-making and stress response. This integrates with CBT/DBT approaches to addiction recovery.</p>
                    <p style="margin-top: 12px;"><a href="https://addictiontreatmentforyou.com/visualization-in-addiction-recovery/" target="_blank">View Research ‚Üí</a></p>
                </div>

                <div style="margin: 40px 0;">
                    <label>1. The Trigger</label>
                    <textarea id="trigger" placeholder="What situation might lead you to consider using?">${data.playingTape.trigger}</textarea>

                    <label>2. The Thoughts</label>
                    <textarea id="thoughts" placeholder="What thoughts run through your mind?">${data.playingTape.thoughts}</textarea>

                    <label>3. The Actions</label>
                    <textarea id="actions" placeholder="What would you do?">${data.playingTape.actions}</textarea>

                    <label>4. The Consequences</label>
                    <textarea id="consequences" style="min-height: 160px;" placeholder="What happens next? Be honest...">${data.playingTape.consequences}</textarea>

                    <label>5. The Aftermath</label>
                    <textarea id="feelings" placeholder="How do you feel 24 hours later?">${data.playingTape.feelings}</textarea>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="goToModule(0)">
                        <span>‚Üê</span> Back
                    </button>
                    <button class="primary" onclick="savePlayingTape()">
                        Continue <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function savePlayingTape() {
            data.playingTape.trigger = document.getElementById('trigger').value;
            data.playingTape.thoughts = document.getElementById('thoughts').value;
            data.playingTape.actions = document.getElementById('actions').value;
            data.playingTape.consequences = document.getElementById('consequences').value;
            data.playingTape.feelings = document.getElementById('feelings').value;
            saveData();
            goToModule(2);
        }

        function renderVisionBoard() {
            document.getElementById('mainCard').innerHTML = `
                <img src="https://image-cdn.klingai.com/2E67FA5DC7A24CD7AFE53DCBA8F696A4%2F0A51AD71B64D4B358D38DE3E3E4BB80B/work_resize_1280_720.jpg" 
                     alt="Vision Board" class="module-image">
                
                <div class="hero-icon">üñºÔ∏è</div>
                <h2>Create Your Vision Board</h2>
                <p style="text-align: center; margin-bottom: 32px; font-size: 1.2rem;">Build a visual representation of your recovery goals.</p>

                <div class="info-box">
                    <h3>The Science Behind This</h3>
                    <p>Vision boards activate neuroplasticity and trigger dopamine release, enhancing goal commitment. Combined with mindfulness, they reduce relapse triggers by reframing negative thought patterns.</p>
                    <p style="margin-top: 12px;"><a href="https://sambarecovery.com/rehab-blog/visualization-techniques-to-support-sobriety/" target="_blank">View Research ‚Üí</a></p>
                </div>

                <div style="margin: 40px 0;">
                    <h3>Your Recovery Goals</h3>
                    <input type="text" id="goal0" placeholder="Goal 1: e.g., Rebuild relationship with my daughter" value="${data.visionBoard.goals[0]}">
                    <input type="text" id="goal1" placeholder="Goal 2" value="${data.visionBoard.goals[1]}">
                    <input type="text" id="goal2" placeholder="Goal 3" value="${data.visionBoard.goals[2]}">

                    <h3 style="margin-top: 48px;">Add Images From Your Device</h3>
                    
                    <div class="file-upload-container">
                        <label for="fileInput" class="file-upload-label">
                            <div class="file-upload-icon">üìÅ</div>
                            <div class="file-upload-text">Browse or Drag & Drop Images</div>
                            <div class="file-upload-subtext">JPG, PNG, or GIF up to 5MB each</div>
                        </label>
                        <input type="file" id="fileInput" accept="image/*" multiple>
                    </div>

                    <div class="image-grid" id="imageGrid">
                        ${renderImageGrid()}
                    </div>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="goToModule(1)">
                        <span>‚Üê</span> Back
                    </button>
                    <button class="primary" onclick="saveVisionBoard()">
                        Continue <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function saveVisionBoard() {
            data.visionBoard.goals[0] = document.getElementById('goal0').value;
            data.visionBoard.goals[1] = document.getElementById('goal1').value;
            data.visionBoard.goals[2] = document.getElementById('goal2').value;
            saveData();
            goToModule(3);
        }

        function renderNumerology() {
            document.getElementById('mainCard').innerHTML = `
                <img src="https://image-cdn.klingai.com/2E67FA5DC7A24CD7AFE53DCBA8F696A4%2FAC2A11CCCBC04C3F81CA99A5BD71C9BA/work_resize_1280_720.jpg" 
                     alt="Numerology" class="module-image">
                
                <div class="hero-icon">‚ú®</div>
                <h2>Your Numerology Analysis</h2>
                <p style="text-align: center; margin-bottom: 32px; font-size: 1.2rem;">Discover the deeper meaning in your numbers.</p>

                <div style="margin: 40px 0;">
                    <label>Your Birth Date:</label>
                    <input type="date" id="birthDate" value="${data.birthDate}" onchange="updateNumerology()">

                    <label>Your Sobriety Date:</label>
                    <input type="date" id="sobrietyDate" value="${data.sobrietyDate}" onchange="updateNumerology()">
                </div>

                <div id="numerologyResults">
                    ${renderNumerologyResults()}
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="goToModule(2)">
                        <span>‚Üê</span> Back
                    </button>
                    <button class="primary" onclick="saveNumerology()" ${!data.birthDate || !data.sobrietyDate ? 'disabled' : ''}>
                        Continue <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function updateNumerology() {
            data.birthDate = document.getElementById('birthDate').value;
            data.sobrietyDate = document.getElementById('sobrietyDate').value;
            data.numerology = calculateNumerology(data.birthDate, data.sobrietyDate);
            saveData();
            document.getElementById('numerologyResults').innerHTML = renderNumerologyResults();
            
            const btn = document.querySelector('.button-group .primary');
            if (data.birthDate && data.sobrietyDate) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }

        function renderNumerologyResults() {
            if (!data.numerology) return '<p style="text-align: center; color: rgba(150,150,150,0.5); font-style: italic;">Enter your dates to see your numerology analysis</p>';

            const karmic = data.numerology.karmicDebt.length > 0 ? `
                <div class="info-box" style="margin-top: 32px;">
                    <h3>Karmic Debt Numbers</h3>
                    ${data.numerology.karmicDebt.map(k => `
                        <div style="margin-bottom: 16px;">
                            <p style="font-family: \'Cormorant Garamond\', serif; font-weight: 500; color: var(--blush); margin-bottom: 6px;">Number ${k.number}</p>
                            <p style="font-size: 0.95rem;">${k.meaning}</p>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            return `
                <div class="numerology-result">
                    <div class="numerology-circle">${data.numerology.lifePath.number}</div>
                    <div class="numerology-title">${data.numerology.lifePath.title}</div>
                    <div class="numerology-subtitle">Your Life Path Number</div>
                    <p class="numerology-message">${data.numerology.lifePath.message}</p>
                </div>

                <div class="info-box pink" style="margin-top: 32px;">
                    <h3>Your Personal Year: <span class="gold-accent">${data.numerology.personalYear.number}</span></h3>
                    <p>${data.numerology.personalYear.meaning}</p>
                </div>

                ${karmic}
            `;
        }

        function saveNumerology() {
            saveData();
            goToModule(4);
        }

        function renderLetterToFuture() {
            document.getElementById('mainCard').innerHTML = `
                <img src="https://image-cdn.klingai.com/2E67FA5DC7A24CD7AFE53DCBA8F696A4%2F75B46DE9D60F430C9A2D61AF98B1B7A0/work_resize_1280_720.jpg" 
                     alt="Letter to Future" class="module-image">
                
                <div class="hero-icon">üíå</div>
                <h2>Letter to Your Future Self</h2>
                <p style="text-align: center; margin-bottom: 32px; font-size: 1.2rem;">Write to yourself one year from now, sober and thriving.</p>

                <div class="info-box gold">
                    <h3>The Science Behind This</h3>
                    <p>Creating vivid scenes of substance-free life enhances self-efficacy and emotional regulation. Research shows this reduces anxiety and boosts coping skills.</p>
                    <p style="margin-top: 12px;"><a href="https://www.leorabh.com/blog/how-to-use-visualization-techniques-in-addiction-recovery" target="_blank">View Research ‚Üí</a></p>
                </div>

                <div class="info-box" style="margin-top: 24px;">
                    <h3 style="font-style: italic;">Prompts to consider:</h3>
                    <ul>
                        <li>What do you hope your life looks like in one year?</li>
                        <li>What are you most afraid of right now?</li>
                        <li>What promises do you want to make to your future self?</li>
                        <li>What relationships do you want to heal or build?</li>
                        <li>What does freedom mean to you?</li>
                    </ul>
                </div>

                <div style="margin: 40px 0;">
                    <textarea id="letterToFuture" style="min-height: 450px;" placeholder="Dear Future Me,

Today is the beginning of my journey. I'm writing to you from a place of hope and determination. 

I want you to know that...">${data.letterToFuture}</textarea>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="goToModule(3)">
                        <span>‚Üê</span> Back
                    </button>
                    <button class="primary" onclick="saveLetterToFuture()">
                        Continue <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function saveLetterToFuture() {
            data.letterToFuture = document.getElementById('letterToFuture').value;
            saveData();
            goToModule(5);
        }

        function renderLetterFromFuture() {
            document.getElementById('mainCard').innerHTML = `
                <img src="https://image-cdn.klingai.com/2E67FA5DC7A24CD7AFE53DCBA8F696A4%2FE7C24DB0FA004C02983D4FB8A62A6C64/work_resize_1280_720.jpg" 
                     alt="Letter from Future" class="module-image">
                
                <div class="hero-icon">‚ù§Ô∏è</div>
                <h2>Letter from Your Future Self</h2>
                <p style="text-align: center; margin-bottom: 32px; font-size: 1.2rem;">Step into the shoes of your future recovered self and write back.</p>

                <div class="info-box pink">
                    <h3>This is the powerful one</h3>
                    <p>Imagine yourself one year from now‚Äîsober, thriving, having achieved the goals on your vision board. What would that version of you say to the person you are today? What wisdom, encouragement, and love would they offer?</p>
                </div>

                ${data.numerology ? `
                    <div class="info-box" style="margin-top: 24px;">
                        <p><strong style="color: var(--lilac);">Remember:</strong> Your Life Path as <span class="gold-accent">${data.numerology.lifePath.title}</span> has guided you here. Your future self has lived this meaning and found their way home.</p>
                    </div>
                ` : ''}

                <div class="info-box" style="margin-top: 24px;">
                    <h3 style="font-style: italic;">Writing as your future self, consider:</h3>
                    <ul>
                        <li>What you're most proud of achieving in your recovery</li>
                        <li>The moments that were hardest and how you got through them</li>
                        <li>What you wish you had known in those early days</li>
                        <li>How your relationships have healed and grown</li>
                        <li>The freedom and peace you've discovered</li>
                        <li>Why every hard moment was worth it</li>
                    </ul>
                </div>

                <div style="margin: 40px 0;">
                    <textarea id="letterFromFuture" style="min-height: 450px;" placeholder="Dear Past Me,

I'm writing to you from one year in the future. I want you to know that you made it. You're here, you're sober, and you're thriving.

Looking back, I remember...">${data.letterFromFuture}</textarea>
                </div>

                <div class="info-box gold" style="margin-top: 24px;">
                    <p><strong style="color: var(--lilac);">Keep this letter:</strong> When things get hard, read this. Your future self believes in you.</p>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="goToModule(4)">
                        <span>‚Üê</span> Back
                    </button>
                    <button class="primary" onclick="saveLetterFromFuture()">
                        Complete Journey <span>‚Üí</span>
                    </button>
                </div>
            `;
        }

        function saveLetterFromFuture() {
            data.letterFromFuture = document.getElementById('letterFromFuture').value;
            saveData();
            goToModule(6);
        }

        function renderCompletion() {
            document.getElementById('mainCard').innerHTML = `
                <div class="hero-icon">üèÜ</div>
                <h1>Your Recovery Journey is Complete</h1>
                <p class="handwriting">You've done powerful, elegant work today</p>
                <p style="text-align: center; margin-bottom: 48px; font-size: 1.2rem;">This sacred space and your reflections are yours to keep and return to.</p>

                <div class="info-box gold" style="background: linear-gradient(135deg, 
                    rgba(200, 162, 200, 0.1) 0%, 
                    rgba(255, 209, 220, 0.08) 100%); 
                    border: 2px solid rgba(212, 175, 55, 0.2);">
                    <h3 style="font-size: 1.5rem; margin-bottom: 24px; text-align: center;">What You've Created:</h3>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 20px; padding: 16px; background: rgba(255, 255, 255, 0.6); border-radius: 12px;">
                            <span style="font-size: 2rem;">‚èÆÔ∏è</span>
                            <div>
                                <p style="font-family: \'Cormorant Garamond\', serif; font-weight: 600; color: var(--lilac); margin-bottom: 4px; font-size: 1.2rem;">Playing the Tape Through</p>
                                <p style="font-size: 0.95rem;">Understanding consequences</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px; padding: 16px; background: rgba(255, 255, 255, 0.6); border-radius: 12px;">
                            <span style="font-size: 2rem;">üñºÔ∏è</span>
                            <div>
                                <p style="font-family: \'Cormorant Garamond\', serif; font-weight: 600; color: var(--lilac); margin-bottom: 4px; font-size: 1.2rem;">Vision Board</p>
                                <p style="font-size: 0.95rem;">${data.visionBoard.goals.filter(g => g).length} goals, ${data.visionBoard.images.length} images</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px; padding: 16px; background: rgba(255, 255, 255, 0.6); border-radius: 12px;">
                            <span style="font-size: 2rem;">‚ú®</span>
                            <div>
                                <p style="font-family: \'Cormorant Garamond\', serif; font-weight: 600; color: var(--lilac); margin-bottom: 4px; font-size: 1.2rem;">Numerology Analysis</p>
                                <p style="font-size: 0.95rem;">${data.numerology ? data.numerology.lifePath.title : 'Not completed'}</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px; padding: 16px; background: rgba(255, 255, 255, 0.6); border-radius: 12px;">
                            <span style="font-size: 2rem;">üíå</span>
                            <div>
                                <p style="font-family: \'Cormorant Garamond\', serif; font-weight: 600; color: var(--lilac); margin-bottom: 4px; font-size: 1.2rem;">Letters to & from Future Self</p>
                                <p style="font-size: 0.95rem;">Connection and wisdom</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid" style="margin: 40px 0;">
                    <div class="grid-item">
                        <h4>üíæ Your Work is Securely Saved</h4>
                        <p>Everything is stored privately on your device. You can close this and return anytime from the same browser.</p>
                    </div>
                    <div class="grid-item pink">
                        <h4>üì± Access Anytime</h4>
                        <p>Bookmark this page or save the link. Come back during quiet moments to reflect and grow.</p>
                    </div>
                </div>

                <button class="primary" onclick="downloadJourney()" style="width: 100%; margin-bottom: 24px; padding: 20px;">
                    <span>üíé</span>
                    Download Your Recovery Journey
                </button>

                <div class="info-box">
                    <h3 style="font-style: italic;">When to Return to This</h3>
                    <ul>
                        <li>When cravings feel overwhelming</li>
                        <li>When you question whether recovery is worth it</li>
                        <li>When you've had a victory and want to celebrate</li>
                        <li>When you need to remember your "why"</li>
                        <li>To update your vision as you grow</li>
                    </ul>
                </div>

                <div style="text-align: center; background: linear-gradient(135deg, 
                    rgba(200, 162, 200, 0.15) 0%, 
                    rgba(255, 209, 220, 0.1) 100%); 
                    padding: 48px; border-radius: 20px; 
                    border: 2px solid rgba(212, 175, 55, 0.2); 
                    margin-top: 40px;">
                    <p style="font-size: 1.4rem; font-family: \'Playfair Display\', serif; 
                        font-weight: 600; background: linear-gradient(135deg, var(--lilac) 0%, var(--blush) 50%, var(--gold) 100%); 
                        -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
                        margin-bottom: 16px; line-height: 1.4;">
                        Your future self is proud of you for doing this elegant, profound work today.
                    </p>
                    <p style="font-size: 1.1rem; color: #666;">
                        One day at a time. You are worthy. You are capable. You are becoming. üíú
                    </p>
                </div>
            `;
        }

        function downloadJourney() {
            const goalsText = data.visionBoard.goals.filter(g => g).map((g, i) => `${i + 1}. ${g}`).join('\n') || 'Not set';
            const imagesText = data.visionBoard.images.length > 0 ? 
                `Images: ${data.visionBoard.images.map(img => img.name).join(', ')}` : 'No images added';
            
            const content = `MY RECOVERY JOURNEY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Date Created: ${new Date().toLocaleDateString('en-US', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
})}
Birth Date: ${data.birthDate || 'Not set'}
Sobriety Date: ${data.sobrietyDate || 'Not set'}

${data.numerology ? `
NUMEROLOGY ANALYSIS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Life Path Number: ${data.numerology.lifePath.number} - ${data.numerology.lifePath.title}
${data.numerology.lifePath.message}

Personal Year: ${data.numerology.personalYear.number}
${data.numerology.personalYear.meaning}

${data.numerology.karmicDebt.length > 0 ? `Karmic Debt Numbers:
${data.numerology.karmicDebt.map(k => `‚Ä¢ Number ${k.number}: ${k.meaning}`).join('\n')}` : ''}
` : ''}

PLAYING THE TAPE THROUGH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Trigger: ${data.playingTape.trigger || 'Not completed'}
Thoughts: ${data.playingTape.thoughts || 'Not completed'}
Actions: ${data.playingTape.actions || 'Not completed'}
Consequences: ${data.playingTape.consequences || 'Not completed'}
Aftermath: ${data.playingTape.feelings || 'Not completed'}

MY RECOVERY GOALS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${goalsText}

VISION BOARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${imagesText}

LETTER TO MY FUTURE SELF
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${data.letterToFuture || 'Not written yet'}

LETTER FROM MY FUTURE SELF
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${data.letterFromFuture || 'Not written yet'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Keep this document. Return to it when you need strength, 
clarity, or a reminder of why you're doing this.

You are worthy of recovery. 
You are capable of change. 
Your future self is waiting for you.

With grace and resilience,
Your Journey Companion
`;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'My-Recovery-Journey-Luxe.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
